!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@aws-amplify/core"),require("@aws-amplify/geo"),require("maplibre-gl")):"function"==typeof define&&define.amd?define(["exports","@aws-amplify/core","@aws-amplify/geo","maplibre-gl"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).maplibreAmplify={},e.aws_amplify_core,e.aws_amplify_geo,e.maplibregl)}(this,(function(e,t,r,o){"use strict";function i(e){return Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]}const n=e=>{let t;return t=i(e[0])?e.map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{place_name:`Coordinates,${e}`}}))):e,t};var s=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{l(o.next(e))}catch(e){n(e)}}function a(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};class a{constructor(e,r){this.refreshCredentials=()=>s(this,void 0,void 0,(function*(){try{this.credentials=yield t.Amplify.Auth.currentCredentials()}catch(e){throw console.error(`Failed to refresh credentials: ${e}`),e}})),this.refreshCredentialsWithRetry=()=>s(this,void 0,void 0,(function*(){yield t.jitteredExponentialRetry(this.refreshCredentials,[],3e5),this.activeTimeout&&clearTimeout(this.activeTimeout);const e=new Date(this.credentials.expiration).getTime()-(new Date).getTime()-1e4;this.activeTimeout=window.setTimeout(this.refreshCredentialsWithRetry,e)})),this.transformRequest=(e,r)=>{if("Style"!==r||e.includes("://")||(e=`https://maps.geo.${this.region}.amazonaws.com/maps/v0/maps/${e}/style-descriptor`),e.includes("amazonaws.com")){const r=e+`?x-amz-user-agent=${encodeURIComponent((o=t.getAmplifyUserAgent(),o.replace(/\./g,"%2E")))}`;return{url:t.Signer.signUrl(r,{access_key:this.credentials.accessKeyId,secret_key:this.credentials.secretAccessKey,session_token:this.credentials.sessionToken})}}var o},this.credentials=e,this.region=r,this.activeTimeout=null,this.refreshCredentialsWithRetry(),t.Hub.listen("auth",(e=>{switch(e.payload.event){case"signIn":case"signOut":case"tokenRefresh":this.refreshCredentialsWithRetry()}}))}}a.createMapLibreMap=({container:e,center:i,zoom:n,style:l,region:c})=>s(void 0,void 0,void 0,(function*(){const s=new a(yield t.Amplify.Auth.currentCredentials(),c).transformRequest;return new o.Map({container:e,center:i,zoom:n,style:l||r.Geo.getDefaultMap().mapName,transformRequest:s})}));const l="#fff",c="#5d8aff";var u;!function(e){e.ESRI_TOPOGRAPHIC="VectorEsriTopographic",e.ESRI_STREETS="VectorEsriStreets",e.ESRI_LIGHT_GRAY="VectorEsriLightGrayCanvas",e.ESRI_DARK_GRAY="VectorEsriDarkGrayCanvas",e.ESRI_NAVIGATION="VectorEsriNavigation",e.HERE_BERLIN="VectorHereBerlin"}(u||(u={}));const d={[u.ESRI_TOPOGRAPHIC]:"Noto Sans Regular",[u.ESRI_STREETS]:"Arial Regular",[u.ESRI_LIGHT_GRAY]:"Ubuntu Regular",[u.ESRI_DARK_GRAY]:"Ubuntu Regular",[u.ESRI_NAVIGATION]:"Arial Regular",[u.HERE_BERLIN]:"Fira GO Regular"};function p(e){const t=(null==e?void 0:e.fillColor)?e.fillColor:c,r=(null==e?void 0:e.strokeColor)?e.strokeColor:l,o=(null==e?void 0:e.lineWidth)?e.lineWidth:4;return{width:64,height:64,data:new Uint8Array(16384),onAdd:function(){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.context=e.getContext("2d")},render:function(){const e=this.context,i=new Path2D("M30 16C30 18.5747 29.1348 21.3832 27.7111 24.2306C26.2947 27.0635 24.3846 29.8177 22.4383 32.2506C20.4964 34.678 18.5493 36.7473 17.0858 38.2108C16.6828 38.6138 16.3174 38.9699 16 39.2739C15.6826 38.9699 15.3172 38.6138 14.9142 38.2108C13.4507 36.7473 11.5036 34.678 9.56174 32.2506C7.61543 29.8177 5.70531 27.0635 4.28885 24.2306C2.86518 21.3832 2 18.5747 2 16C2 8.26801 8.26801 2 16 2C23.732 2 30 8.26801 30 16Z");return e.stroke(i),e.fillStyle=t,e.strokeStyle=r,e.lineWidth=o,e.fill(i),this.data=e.getImageData(0,0,this.width,this.height).data,!0}}}var f=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]])}return r};const y="amplify-tip";function h(e,t,r){var{showMarkerPopup:n=!1}=r,s=f(r,["showMarkerPopup"]);const a=`${e}-layer-unclustered-point`,l=function(e,{popupBackgroundColor:t="#fff",popupBorderColor:r="#0000001f",popupBorderWidth:o=2,popupFontColor:i="#000",popupPadding:n=20,popupBorderRadius:s=4,popupTitleFontWeight:a="bold"}){return l=>{let c,u;if("string"==typeof(d=l.properties.place_name)&&d.length>0){const e=l.properties.place_name.split(",");c=e[0],u=e.splice(1,e.length).join(",")}else c="Coordinates",u=l.geometry.coordinates;var d;return`\n      <div class="${e}-popup" style="background: ${t}; border: ${o}px solid ${r}; color: ${i}; border-radius: ${s}px; padding: ${n}px; word-wrap: break-word; margin: -10px -10px -15px;">\n        <div class="${e}-popup-title" style="font-weight: ${a};">\n          ${c}\n        </div>\n        <div class="${e}-popup-address">\n          ${u}\n        </div>\n      </div>`}}(a,s);!function(e,{selectedColor:t="#ff9900",selectedBorderColor:r="#fff",selectedBorderWidth:o=4,defaultBorderColor:i="#fff",defaultBorderWidth:n=4,defaultColor:s="#5d8aff"}){const a=p({fillColor:s,strokeColor:i,lineWidth:n}),l=p({fillColor:t,strokeColor:r,lineWidth:o});e.addImage("inactive-marker",a,{pixelRatio:2}),e.addImage("active-marker",l,{pixelRatio:2})}(t,s);const c={id:a,type:"symbol",source:e,filter:["!",["has","point_count"]],layout:{"icon-image":"inactive-marker"}};if(t.addLayer(Object.assign({},c)),n){if(!document.getElementById(y)){const e=document.createElement("style");e.setAttribute("id",y),document.head.append(e),e.textContent=".mapboxgl-popup-tip { display: none; }"}}return t.on("click",a,(function(e){if("function"==typeof s.onClick&&s.onClick(e),t.setLayoutProperty(a,"icon-image",["match",["id"],e.features[0].id,"active-marker","inactive-marker"]),n){const r=e.features[0],n=r.geometry.coordinates;i(n)&&(new o.Popup).setLngLat(n).setHTML(l(r)).setOffset(15).addTo(t)}})),{unclusteredLayerId:a}}e.AmplifyMapLibreRequest=a,e.drawPoints=function(e,t,o,{showCluster:i=!0,clusterOptions:s={},unclusteredOptions:a={}},l){var c;if(!o||"function"!=typeof o.addSource||"function"!=typeof o.addLayer)throw new Error("Please use a maplibre map");const u=n(t),p=`${e}-source-points`;let f,y;o.addSource(p,{type:"geojson",data:{type:"FeatureCollection",features:u},cluster:i,clusterMaxZoom:null!==(c=s.clusterMaxZoom)&&void 0!==c?c:14,generateId:!0}),i&&({clusterLayerId:f,clusterSymbolLayerId:y}=function(e,t,{fillColor:o="#5d8aff",smCircleSize:i=60,smThreshold:n=50,mdCircleSize:s=100,mdThreshold:a=100,lgCircleSize:l=140,lgThreshold:c=500,xlCircleSize:u=180,borderWidth:p=4,borderColor:f="#fff",clusterPaint:y,onClick:h,showCount:m,clusterCountLayout:g,fontColor:C="#fff"},v){const b=`${e}-layer-clusters`,R=`${e}-layer-cluster-count`,w=Object.assign({"circle-color":["step",["get","point_count"],o,n,o,a,o,c,o],"circle-radius":["step",["get","point_count"],i,n,s,a,l,c,u],"circle-stroke-width":p,"circle-stroke-color":f},y),I={id:b,type:"circle",source:e,filter:["has","point_count"],paint:w};if(t.addLayer(Object.assign({},I)),t.on("click",b,(function(r){"function"==typeof h&&h(r);const o=t.queryRenderedFeatures(r.point,{layers:[b]}),i=o[0].properties.cluster_id,n=t.getSource(e);(function(e){return"geojson"===e.type})(n)&&n.getClusterExpansionZoom(i,(function(e,r){e||t.easeTo({center:o[0].geometry.coordinates,zoom:r})}))})),m){const o={"text-field":"{point_count_abbreviated}","text-size":24},i=v||r.Geo.getDefaultMap().style;i&&(o["text-font"]=[d[i]]);const n=Object.assign(Object.assign({},o),g),s={id:R,type:"symbol",source:e,filter:["has","point_count"],layout:n,paint:{"text-color":C}};t.addLayer(Object.assign({},s))}return{clusterLayerId:b,clusterSymbolLayerId:R}}(p,o,s,l));const{unclusteredLayerId:m}=h(p,o,a||{});return{sourceId:p,unclusteredLayerId:m,clusterLayerId:f,clusterSymbolLayerId:y}},Object.defineProperty(e,"__esModule",{value:!0})}));